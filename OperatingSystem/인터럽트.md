# 인터럽트

> 프로그램을 실행하는 중에 예기치 않은 상황이 발생한 경우 CPU에게 알리는 것

CPU가 프로그램을 실행하고 있을 때 예기치 않은 상황이 발생한 경우, 현재 실행 중인 작업을 즉시 중단하고 발생한 상황에 대한 처리가 필요하다는 것을 CPU에게 알리는 것이 **인터럽트**이다.

실행하고 있던 일보다 더 중요한 일이 발생하면 해당 일을 먼저 처리하고 나서 하던 일을 계속한다.

<br>

## 인터럽트의 종류

### 하드웨어 인터럽트
> CPU가 아닌 다른 하드웨어가 발생시키는 인터럽트

CPU가 아닌 다른 하드웨어 장치가 CPU에게 어떤 사실을 알려주거나, CPU 서비스의 요청이 필요한 경우 발생하는 인터럽트로 Maskable interrupt와 Non-maskable interrupt가 있다.
+ Maskable interrupt
  + interrupt Mask (인터럽트가 발생하였을 때 요구를 받아들일지 말지 결정정하는 것)가 가능
+ Non-maskable interrupt
  + interrupt Mask (인터럽트가 발생하였을 때 요구를 받아들일지 말지 결정정하는 것)가 불가능
    + 정전, 하드웨어 고장과 같은 거부, 무시할 수 없는 오류   
<br>

#### 하드웨어 인터럽트 발생 예시
- 기계 검사 인터럽트 - 정전이나 컴퓨터 자체에서 기계적인 문제 발생
- 외부 인터럽트 - 오퍼레이터나 타이머에 의해 의도적으로 프로그램 중단
- 입출력 인터럽트 - 입출력의 종료나 오류에 의해 CPU의 기능 요청되는 경우
- 프로그램 검사 인터럽트 - 프로그램 실행 중 보호된 기억 공간 내에 접근하거나 불법 명령 수행 같은 프로그램 문제 발생하는 경우

<br>

### 소프트웨어 인터럽트
> CPU 내부에서 발생하는 인터럽트

CPU 내부에서 자신이 실행한 명령이나 CPU의 명령 실행에 관련된 모듈이 변화하는 경우 발생하는 인터럽트이다.

프로그램 실행 중 트랩(trap)이나 예외(Exception)를 알리기 위해 발생하거나
<br>
프로그램 내에서 특별한 서비스를 요구하거나 감시를 목적으로 의도적으로 프로그램이 발생시킨 명령어에 의해 발생한다.

- 트랩:  프로그램 상의 처리 불가능한 오류나 이벤트

<br>

#### 소프트웨어 인터럽트 발생 예시
- 프로그램 검사 인터럽트
    - 존재하지 않는 메모리 주소에 접근
    - 0으로 나누고자 할 때
- SVC(Supervisor call - 감시 프로그램 호출) 인터럽트
    - 사용자가 프로그램을 실행시키거나 supervisor를 호출하는 동작을 수행하는 경우
    - 프로그래머에 의해 코드로 짜인 감시 프로그램 호출하는 방식

<br>

## 인터럽트 발생 처리 과정
> 프로그램 실행 중 디스크에서 어떤 데이터를 읽어오라는 명령을 받은 경우

1. 프로그램 실행
    1. 인터럽트 발생
2. 프로그램 중단
    1. CPU 현재 진행 중이던 기계어 코드 완료
    2. 현재까지 수행한 상태를 해당 프로세스의 PCB에 저장
    3. 프로그램 상태를 스택에 저장
        1. PC(Program Counter: 다음 실행할 명령 주소) 저장
        2. SR(Status Register: 상태) 저장
3. 인터럽트 처리
    1. 인터럽트 벡터에서 ISR 주소값 얻어 ISR로 점프하여 인터럽트 루틴 결정
4. 인터럽트 수행
    1. 인터럽트 루틴 실행
    2. 실행이 끝나면 저장했던 프로세스 상태 복구
    3. ISR 끝의 인터럽트 복귀 명령어(RETI) 실행
    4. IRET 명령어 실행되면 PC, SR 값 복원하여 이전 실행위치로 복원
5. 프로그램 재실행

<br>

## 인터럽트가 필요한 이유?
> 주변 장치와 입출력장치는 인터럽트를 통해 관리되는데, 입출력 연산이 CPU 명령 수행 속도보다 매우 느리기 때문

오랜 시간이 걸리는 입출력 연산을 CPU가 매번 기다릴 수 없기 때문에 입출력 연산이 완료되면 이를 CPU에게 알려주고자 인터럽트를 사용한다.
